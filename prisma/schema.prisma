// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// Projects table - main data for portfolio
model Project {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  description     String
  longDescription String   @default("")
  category        String   // "mobile" | "telegram" | "web" | "saas" | "discord"
  progress        Int      @default(0) // 0-100
  technologies    String   // JSON array stored as string
  githubUrl       String?
  demoUrl         String?
  images          String   @default("[]") // JSON array stored as string
  screenshots     String   @default("[]") // JSON array of screenshot URLs
  ideaText        String   @default("") // "The Idea" section text
  clientBenefit   String   @default("") // What the client gets
  featured        Boolean  @default(false)
  order           Int      @default(0)
  localPath       String   @default("") // Local filesystem path for workspace
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  roadmapItems   RoadmapItem[]
  activityLogs   ActivityLog[]
  crmTasks       CrmTask[]
}

// Roadmap items for each project
model RoadmapItem {
  id        String   @id @default(cuid())
  title     String
  status    String   // "done" | "in-progress" | "planned"
  order     Int      @default(0)
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Skills for about page
model Skill {
  id       String @id @default(cuid())
  name     String
  level    Int    // 0-100
  category String // "language" | "frontend" | "backend" | "database" | "devops" | "cloud" | "architecture"
  order    Int    @default(0)
}

// Social links
model SocialLink {
  id    String @id @default(cuid())
  name  String
  url   String
  icon  String
  order Int    @default(0)
}

// Site settings (slogan, bio, etc.)
model SiteSetting {
  id    String @id @default(cuid())
  key   String @unique
  value String
}

// Contact form submissions (lead pipeline)
model ContactSubmission {
  id          String   @id @default(cuid())
  name        String
  email       String
  subject     String
  message     String
  budget      String   @default("")
  serviceType String   @default("")
  read        Boolean  @default(false)
  status      String   @default("new")     // "new" | "contacted" | "qualified" | "proposal" | "won" | "lost" | "archived"
  label       String   @default("")        // "hot" | "warm" | "cold" | "" 
  notes       String   @default("")        // Internal notes
  dealValue   Int      @default(0)         // Actual deal amount in USD
  createdAt   DateTime @default(now())
}

// Services offered
model Service {
  id            String   @id @default(cuid())
  title         String
  titleRu       String   @default("")
  slug          String   @unique
  icon          String   // emoji icon
  description   String
  descriptionRu String   @default("")
  features      String   @default("[]") // JSON array of feature strings
  featuresRu    String   @default("[]")
  timeline      String   // e.g. "from 3 days"
  timelineRu    String   @default("")
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// Activity log for project tracking (mini-CRM)
model ActivityLog {
  id        String   @id @default(cuid())
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  type      String   // "push" | "task" | "note" | "deploy" | "milestone"
  title     String
  details   String   @default("")
  author    String   @default("agent") // "agent" | "manual"
  createdAt DateTime @default(now())
}

// CRM tasks for kanban board
model CrmTask {
  id          String    @id @default(cuid())
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  title       String
  description String    @default("")
  type        String    @default("task")    // "task" | "milestone" | "bug" | "feature"
  status      String    @default("backlog") // "backlog" | "todo" | "in-progress" | "review" | "done"
  priority    String    @default("medium")  // "low" | "medium" | "high" | "urgent"
  dueDate     DateTime?
  order       Int       @default(0)
  author      String    @default("agent")   // "agent" | "manual"
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// Page view analytics
model PageView {
  id        String   @id @default(cuid())
  path      String           // e.g. "/", "/projects/my-app"
  referrer  String   @default("")  // Where user came from
  country   String   @default("")  // Geolocation (if available)
  device    String   @default("")  // "desktop" | "mobile" | "tablet"
  browser   String   @default("")  // "Chrome" | "Safari" etc.
  createdAt DateTime @default(now())
}
